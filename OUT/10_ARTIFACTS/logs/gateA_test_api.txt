
> @vexel/api@0.1.0 test /home/munaim/srv/apps/vexel/apps/api
> jest

PASS src/catalog/__tests__/catalog-import.spec.ts (7.414 s)
PASS src/documents/__tests__/canonical.spec.ts (7.772 s)
PASS src/rbac/permissions.guard.spec.ts (8.733 s)
PASS src/documents/__tests__/document-idempotency.spec.ts
PASS src/documents/__tests__/documents.service.spec.ts
PASS src/encounters/__tests__/encounter-workflow.spec.ts
  â— Console

    console.error
      [encounters] Failed to generate encounterCode: Cannot read properties of undefined (reading 'findUnique')

      197 |         (updatedEncounter as any).encounterCode = encounterCode;
      198 |       } catch (err) {
    > 199 |         console.error('[encounters] Failed to generate encounterCode:', (err as Error).message);
          |                 ^
      200 |       }
      201 |     }
      202 |

      at EncountersService.orderLab (encounters/encounters.service.ts:199:17)
      at Object.<anonymous> (encounters/__tests__/encounter-workflow.spec.ts:105:24)

    console.error
      [encounters] Failed to auto-create SpecimenItem: Cannot read properties of undefined (reading 'upsert')

      222 |       });
      223 |     } catch (err) {
    > 224 |       console.error('[encounters] Failed to auto-create SpecimenItem:', (err as Error).message);
          |               ^
      225 |     }
      226 |
      227 |     // Auto-generate RECEIPT document after order finalization (non-fatal)

      at EncountersService.orderLab (encounters/encounters.service.ts:224:15)
      at Object.<anonymous> (encounters/__tests__/encounter-workflow.spec.ts:105:24)

    console.error
      [encounters] Failed to auto-generate receipt after order-lab: Cannot read properties of undefined (reading 'findUnique')

      285 |     } catch (err) {
      286 |       // Non-fatal: receipt generation failure must not block order placement
    > 287 |       console.error('[encounters] Failed to auto-generate receipt after order-lab:', (err as Error).message);
          |               ^
      288 |     }
      289 |
      290 |     return updatedEncounter;

      at EncountersService.orderLab (encounters/encounters.service.ts:287:15)
      at Object.<anonymous> (encounters/__tests__/encounter-workflow.spec.ts:105:24)

    console.error
      [encounters] Failed to generate encounterCode: Cannot read properties of undefined (reading 'findUnique')

      197 |         (updatedEncounter as any).encounterCode = encounterCode;
      198 |       } catch (err) {
    > 199 |         console.error('[encounters] Failed to generate encounterCode:', (err as Error).message);
          |                 ^
      200 |       }
      201 |     }
      202 |

      at EncountersService.orderLab (encounters/encounters.service.ts:199:17)
      at Object.<anonymous> (encounters/__tests__/encounter-workflow.spec.ts:159:5)

    console.error
      [encounters] Failed to auto-create SpecimenItem: Cannot read properties of undefined (reading 'upsert')

      222 |       });
      223 |     } catch (err) {
    > 224 |       console.error('[encounters] Failed to auto-create SpecimenItem:', (err as Error).message);
          |               ^
      225 |     }
      226 |
      227 |     // Auto-generate RECEIPT document after order finalization (non-fatal)

      at EncountersService.orderLab (encounters/encounters.service.ts:224:15)
      at Object.<anonymous> (encounters/__tests__/encounter-workflow.spec.ts:159:5)

    console.error
      [encounters] Failed to auto-generate receipt after order-lab: Cannot read properties of undefined (reading 'findUnique')

      285 |     } catch (err) {
      286 |       // Non-fatal: receipt generation failure must not block order placement
    > 287 |       console.error('[encounters] Failed to auto-generate receipt after order-lab:', (err as Error).message);
          |               ^
      288 |     }
      289 |
      290 |     return updatedEncounter;

      at EncountersService.orderLab (encounters/encounters.service.ts:287:15)
      at Object.<anonymous> (encounters/__tests__/encounter-workflow.spec.ts:159:5)

PASS src/appointments/__tests__/appointments.service.spec.ts
PASS src/billing/__tests__/billing.service.spec.ts
PASS src/tenant/tenant-resolver.middleware.spec.ts

Test Suites: 9 passed, 9 total
Tests:       47 passed, 47 total
Snapshots:   0 total
Time:        11.222 s
Ran all test suites.
