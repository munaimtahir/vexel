openapi: 3.1.0
info:
  title: Vexel Health API (LIMS-first)
  version: 0.1.0
  description: |
    Contract-first OpenAPI spec for Vexel Health Platform.
    All admin endpoints require bearerAuth.
    All requests should include X-Correlation-ID header.
    Tenant is resolved server-side (Host header in prod, x-tenant-id in dev when enabled).

servers:
  - url: /api

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    CorrelationId:
      name: X-Correlation-ID
      in: header
      required: false
      schema:
        type: string
        format: uuid
      description: Client-supplied correlation ID. If not provided, server generates one.
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
    LimitParam:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

  schemas:
    Error:
      type: object
      required: [statusCode, message]
      properties:
        statusCode:
          type: integer
        message:
          type: string
        error:
          type: string
        correlationId:
          type: string

    Pagination:
      type: object
      required: [page, limit, total, totalPages]
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    HealthStatus:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [ok, degraded, down]
        version:
          type: string
        uptime:
          type: number
        services:
          type: object
          additionalProperties:
            type: string

    TokenResponse:
      type: object
      required: [accessToken, refreshToken, expiresIn]
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresIn:
          type: integer
        tokenType:
          type: string
          default: Bearer

    UserSummary:
      type: object
      required: [id, email, tenantId, status]
      properties:
        id:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        tenantId:
          type: string
        roles:
          type: array
          items:
            type: string
        status:
          type: string
          enum: [active, disabled, pending]
        isSuperAdmin:
          type: boolean
        createdAt:
          type: string
          format: date-time

    TenantSummary:
      type: object
      required: [id, name, status]
      properties:
        id:
          type: string
        name:
          type: string
        domains:
          type: array
          items:
            type: string
        status:
          type: string
          enum: [active, suspended, trial]
        createdAt:
          type: string
          format: date-time

    TenantConfig:
      type: object
      properties:
        brandName:
          type: string
        logoUrl:
          type: string
        primaryColor:
          type: string
        headerText:
          type: string
        footerText:
          type: string
        reportHeader:
          type: string
          description: Header text printed on generated PDF reports
        reportFooter:
          type: string
          description: Footer text printed on generated PDF reports

    Role:
      type: object
      required: [id, name]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        permissions:
          type: array
          description: List of permission keys assigned to this role
          items:
            type: string
        isSystem:
          type: boolean
          description: True for built-in system roles that cannot be deleted

    FeatureFlag:
      type: object
      required: [key, enabled]
      properties:
        key:
          type: string
        enabled:
          type: boolean
        description:
          type: string

    CatalogTest:
      type: object
      required: [id, tenantId, code, name]
      properties:
        id:
          type: string
        tenantId:
          type: string
        code:
          type: string
        name:
          type: string
        description:
          type: string
        sampleType:
          type: string
        turnaroundHours:
          type: integer
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    CatalogPanel:
      type: object
      required: [id, tenantId, code, name]
      properties:
        id:
          type: string
        tenantId:
          type: string
        code:
          type: string
        name:
          type: string
        description:
          type: string
        testIds:
          type: array
          items:
            type: string
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    Parameter:
      type: object
      required: [id, tenantId, code, name, dataType, isActive]
      properties:
        id:
          type: string
        tenantId:
          type: string
        code:
          type: string
        name:
          type: string
        unit:
          type: string
        dataType:
          type: string
          enum: [numeric, text, boolean, coded]
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TestParameterMapping:
      type: object
      required: [id, testId, parameterId]
      properties:
        id:
          type: string
        testId:
          type: string
        parameterId:
          type: string
        ordering:
          type: integer
          default: 0

    PanelTestMapping:
      type: object
      required: [id, panelId, testId]
      properties:
        id:
          type: string
        panelId:
          type: string
        testId:
          type: string
        ordering:
          type: integer
          default: 0

    ReferenceRange:
      type: object
      required: [id, tenantId, parameterId]
      properties:
        id:
          type: string
        tenantId:
          type: string
        parameterId:
          type: string
        testId:
          type: string
        gender:
          type: string
          enum: [M, F]
          nullable: true
        ageMinYears:
          type: integer
          nullable: true
        ageMaxYears:
          type: integer
          nullable: true
        lowValue:
          type: number
          nullable: true
        highValue:
          type: number
          nullable: true
        criticalLow:
          type: number
          nullable: true
        criticalHigh:
          type: number
          nullable: true
        unit:
          type: string

    JobRun:
      type: object
      required: [id, tenantId, type, status, correlationId, createdBy, createdAt]
      properties:
        id:
          type: string
        tenantId:
          type: string
        type:
          type: string
          enum: [catalog.import, catalog.export]
        status:
          type: string
          enum: [queued, running, completed, failed]
        payloadHash:
          type: string
          nullable: true
        correlationId:
          type: string
        startedAt:
          type: string
          format: date-time
          nullable: true
        finishedAt:
          type: string
          format: date-time
          nullable: true
        resultSummary:
          type: object
          nullable: true
          properties:
            created:
              type: integer
            updated:
              type: integer
            skipped:
              type: integer
            total:
              type: integer
        errorSummary:
          type: string
          nullable: true
        createdBy:
          type: string
        createdAt:
          type: string
          format: date-time

    CatalogImportPayload:
      type: object
      properties:
        tests:
          type: array
          items:
            type: object
            required: [code, name]
            properties:
              code:
                type: string
              name:
                type: string
              description:
                type: string
              sampleType:
                type: string
              turnaroundHours:
                type: integer
        parameters:
          type: array
          items:
            type: object
            required: [code, name]
            properties:
              code:
                type: string
              name:
                type: string
              unit:
                type: string
              dataType:
                type: string
                enum: [numeric, text, boolean, coded]
        panels:
          type: array
          items:
            type: object
            required: [code, name]
            properties:
              code:
                type: string
              name:
                type: string
              description:
                type: string
        mappings:
          type: array
          items:
            type: object
            properties:
              testCode:
                type: string
              parameterCode:
                type: string
              ordering:
                type: integer

    AuditEvent:
      type: object
      required: [id, tenantId, action, createdAt]
      properties:
        id:
          type: string
        tenantId:
          type: string
        actorUserId:
          type: string
        action:
          type: string
        entityType:
          type: string
        entityId:
          type: string
        correlationId:
          type: string
        before:
          type: object
          nullable: true
        after:
          type: object
          nullable: true
        createdAt:
          type: string
          format: date-time

    Job:
      type: object
      required: [id, queue, status]
      properties:
        id:
          type: string
        queue:
          type: string
        name:
          type: string
        status:
          type: string
          enum: [waiting, active, completed, failed, delayed]
        data:
          type: object
        failedReason:
          type: string
          nullable: true
        attemptsMade:
          type: integer
        createdAt:
          type: string
          format: date-time
        processedAt:
          type: string
          format: date-time
          nullable: true

    PermissionKey:
      type: string
      enum:
        - admin.super
        - tenant.read
        - tenant.create
        - tenant.update
        - user.read
        - user.create
        - user.update
        - user.disable
        - role.read
        - role.create
        - role.update
        - role.delete
        - role.assign
        - feature_flag.read
        - feature_flag.set
        - catalog.read
        - catalog.write
        - catalog.manage
        - audit.read
        - job.read
        - job.retry
        - branding.read
        - branding.write
        - patient.manage
        - encounter.manage
        - result.enter
        - result.verify

    Patient:
      type: object
      required: [id, tenantId, firstName, lastName, mrn, createdAt]
      properties:
        id:
          type: string
        tenantId:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        dateOfBirth:
          type: string
          format: date
          nullable: true
        gender:
          type: string
          nullable: true
        mrn:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Encounter:
      type: object
      required: [id, tenantId, patientId, status, createdAt]
      properties:
        id:
          type: string
        tenantId:
          type: string
        patientId:
          type: string
        status:
          type: string
          enum: [registered, lab_ordered, specimen_collected, resulted, verified, cancelled]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        patient:
          $ref: '#/components/schemas/Patient'
        labOrders:
          type: array
          items:
            $ref: '#/components/schemas/LabOrder'

    LabOrder:
      type: object
      required: [id, tenantId, encounterId, testId, status, priority, createdAt]
      properties:
        id:
          type: string
        tenantId:
          type: string
        encounterId:
          type: string
        testId:
          type: string
        status:
          type: string
          enum: [ordered, specimen_collected, processing, resulted, verified, cancelled]
        priority:
          type: string
          enum: [routine, stat, urgent]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        specimen:
          $ref: '#/components/schemas/Specimen'
        result:
          $ref: '#/components/schemas/LabResult'

    Specimen:
      type: object
      required: [id, tenantId, labOrderId, barcode, type, status, createdAt]
      properties:
        id:
          type: string
        tenantId:
          type: string
        labOrderId:
          type: string
        barcode:
          type: string
        type:
          type: string
        collectedAt:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
          enum: [pending, collected, received, rejected]
        createdAt:
          type: string
          format: date-time

    LabResult:
      type: object
      required: [id, tenantId, labOrderId, value, resultedAt]
      properties:
        id:
          type: string
        tenantId:
          type: string
        labOrderId:
          type: string
        value:
          type: string
        unit:
          type: string
          nullable: true
        referenceRange:
          type: string
          nullable: true
        flag:
          type: string
          enum: [normal, high, low, critical]
          nullable: true
        resultedAt:
          type: string
          format: date-time
        resultedBy:
          type: string
          nullable: true
        verifiedAt:
          type: string
          format: date-time
          nullable: true
        verifiedBy:
          type: string
          nullable: true

    Document:
      type: object
      properties:
        id:
          type: string
        tenantId:
          type: string
        type:
          type: string
          enum: [RECEIPT, LAB_REPORT]
        templateId:
          type: string
        payloadHash:
          type: string
        pdfHash:
          type: string
          nullable: true
        status:
          type: string
          enum: [DRAFT, RENDERING, RENDERED, PUBLISHED, FAILED]
        version:
          type: integer
        sourceRef:
          type: string
          nullable: true
        sourceType:
          type: string
          nullable: true
        errorMessage:
          type: string
          nullable: true
        publishedAt:
          type: string
          format: date-time
          nullable: true
        createdBy:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    DocumentTemplate:
      type: object
      properties:
        id:
          type: string
        tenantId:
          type: string
        type:
          type: string
          enum: [RECEIPT, LAB_REPORT]
        templateKey:
          type: string
        version:
          type: integer
        config:
          type: object
          nullable: true
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ReceiptGenerateRequest:
      type: object
      required: [receiptNumber, patientName, patientMrn, issuedAt, items, subtotal, tax, grandTotal]
      properties:
        receiptNumber:
          type: string
        patientName:
          type: string
        patientMrn:
          type: string
        issuedAt:
          type: string
          format: date-time
        items:
          type: array
          items:
            type: object
            required: [description, quantity, unitPrice, total]
            properties:
              description:
                type: string
              quantity:
                type: number
              unitPrice:
                type: number
              total:
                type: number
        subtotal:
          type: number
        tax:
          type: number
        grandTotal:
          type: number
        sourceRef:
          type: string
          nullable: true
        sourceType:
          type: string
          nullable: true

    ReportGenerateRequest:
      type: object
      required: [reportNumber, patientName, patientMrn, encounterId, tests]
      properties:
        reportNumber:
          type: string
        patientName:
          type: string
        patientMrn:
          type: string
        patientDob:
          type: string
          nullable: true
        patientGender:
          type: string
          nullable: true
        encounterId:
          type: string
        orderedBy:
          type: string
          nullable: true
        tests:
          type: array
          items:
            type: object
            required: [testCode, testName, parameters]
            properties:
              testCode:
                type: string
              testName:
                type: string
              parameters:
                type: array
                items:
                  type: object
                  required: [parameterCode, parameterName, value]
                  properties:
                    parameterCode:
                      type: string
                    parameterName:
                      type: string
                    value:
                      type: string
                    unit:
                      type: string
                      nullable: true
                    referenceRange:
                      type: string
                      nullable: true
                    flag:
                      type: string
                      enum: [normal, high, low, critical]
                      nullable: true
        verifiedBy:
          type: string
          nullable: true
        verifiedAt:
          type: string
          format: date-time
          nullable: true
        sourceRef:
          type: string
          nullable: true
        sourceType:
          type: string
          nullable: true

paths:
  # ─── Health ───────────────────────────────────────────────────────────────
  /health:
    get:
      operationId: getHealth
      summary: API health check
      security: []
      tags: [Health]
      parameters:
        - $ref: '#/components/parameters/CorrelationId'
      responses:
        "200":
          description: Service is healthy
          headers:
            X-Correlation-ID:
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /health/worker:
    get:
      operationId: getWorkerHealth
      summary: Worker health check
      security: []
      tags: [Health]
      responses:
        "200":
          description: Worker is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /health/pdf:
    get:
      operationId: getPdfHealth
      summary: PDF service health check
      security: []
      tags: [Health]
      responses:
        "200":
          description: PDF service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  # ─── Auth ─────────────────────────────────────────────────────────────────
  /auth/login:
    post:
      operationId: login
      summary: Login (admin or operator)
      security: []
      tags: [Auth]
      parameters:
        - $ref: '#/components/parameters/CorrelationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/refresh:
    post:
      operationId: refreshToken
      summary: Refresh access token
      security: []
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        "200":
          description: Tokens refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        "401":
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/logout:
    post:
      operationId: logout
      summary: Logout (revoke refresh token)
      tags: [Auth]
      responses:
        "204":
          description: Logged out successfully

  /me:
    get:
      operationId: getMe
      summary: Get current authenticated user
      tags: [Auth]
      responses:
        "200":
          description: Current user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSummary'

  # ─── Tenants ──────────────────────────────────────────────────────────────
  /tenants:
    get:
      operationId: listTenants
      summary: List tenants (super-admin only)
      tags: [Tenants]
      parameters:
        - $ref: '#/components/parameters/CorrelationId'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: List of tenants
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TenantSummary'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      operationId: createTenant
      summary: Create a new tenant (super-admin only)
      tags: [Tenants]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, domains]
              properties:
                name:
                  type: string
                domains:
                  type: array
                  items:
                    type: string
                status:
                  type: string
                  enum: [active, suspended, trial]
                  default: trial
      responses:
        "201":
          description: Tenant created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSummary'
        "409":
          description: Domain already in use
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /tenants/{tenantId}:
    get:
      operationId: getTenant
      summary: Get tenant by ID
      tags: [Tenants]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Tenant detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSummary'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      operationId: updateTenant
      summary: Update tenant
      tags: [Tenants]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                domains:
                  type: array
                  items:
                    type: string
                status:
                  type: string
                  enum: [active, suspended, trial]
      responses:
        "200":
          description: Updated tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSummary'

  /tenants/{tenantId}/config:
    get:
      operationId: getTenantConfig
      summary: Get tenant branding/config
      tags: [Tenants]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Tenant config
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantConfig'
    patch:
      operationId: updateTenantConfig
      summary: Update tenant branding/config
      tags: [Tenants]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantConfig'
      responses:
        "200":
          description: Updated config
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantConfig'

  /tenants/{tenantId}/feature-flags:
    get:
      operationId: getTenantFeatureFlags
      summary: Get feature flags for a tenant
      tags: [FeatureFlags]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Feature flags
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FeatureFlag'
    put:
      operationId: setTenantFeatureFlags
      summary: Set feature flags for a tenant
      tags: [FeatureFlags]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                required: [key, enabled]
                properties:
                  key:
                    type: string
                  enabled:
                    type: boolean
      responses:
        "200":
          description: Updated feature flags
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FeatureFlag'

  # ─── Users ────────────────────────────────────────────────────────────────
  /users:
    get:
      operationId: listUsers
      summary: List users (tenant-scoped)
      tags: [Users]
      parameters:
        - $ref: '#/components/parameters/CorrelationId'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [active, disabled, pending]
      responses:
        "200":
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserSummary'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      operationId: createUser
      summary: Create a new user (tenant-scoped)
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, firstName, lastName, password]
              properties:
                email:
                  type: string
                  format: email
                firstName:
                  type: string
                lastName:
                  type: string
                password:
                  type: string
                roles:
                  type: array
                  items:
                    type: string
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSummary'
        "409":
          description: Email already in use within tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/{userId}:
    get:
      operationId: getUser
      summary: Get user by ID
      tags: [Users]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSummary'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      operationId: updateUser
      summary: Update user (name, status)
      tags: [Users]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                status:
                  type: string
                  enum: [active, disabled]
      responses:
        "200":
          description: Updated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSummary'

  /users/{userId}/roles:
    get:
      operationId: getUserRoles
      summary: Get roles assigned to user
      tags: [Users]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
    put:
      operationId: setUserRoles
      summary: Set roles for user (replaces current assignment)
      tags: [Users]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [roleIds]
              properties:
                roleIds:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Updated roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'

  # ─── Roles ────────────────────────────────────────────────────────────────
  /roles:
    get:
      operationId: listRoles
      summary: List roles (tenant-scoped)
      tags: [Roles]
      responses:
        "200":
          description: Roles list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
    post:
      operationId: createRole
      summary: Create a role
      tags: [Roles]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                description:
                  type: string
                permissions:
                  type: array
                  items:
                    type: string
      responses:
        "201":
          description: Role created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'

  /roles/{roleId}:
    patch:
      operationId: updateRole
      summary: Update a role
      tags: [Roles]
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                permissions:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Updated role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'

  /roles/permissions:
    get:
      operationId: listPermissions
      summary: List all available system permissions
      tags: [Roles]
      responses:
        "200":
          description: All permission keys
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  # ─── Feature Flags (global / system) ──────────────────────────────────────
  /feature-flags:
    get:
      operationId: listFeatureFlags
      summary: List all feature flag keys and their descriptions
      tags: [FeatureFlags]
      responses:
        "200":
          description: All feature flags
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FeatureFlag'

  /feature-flags/{key}:
    put:
      operationId: setFeatureFlag
      summary: Enable or disable a feature flag system-wide
      tags: [FeatureFlags]
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [enabled]
              properties:
                enabled:
                  type: boolean
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlag'

  # ─── Catalog ──────────────────────────────────────────────────────────────
  /catalog/tests:
    get:
      operationId: listCatalogTests
      summary: List catalog tests (tenant-scoped)
      tags: [Catalog]
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: Catalog tests
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CatalogTest'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      operationId: createCatalogTest
      summary: Create a catalog test
      tags: [Catalog]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, name]
              properties:
                code:
                  type: string
                name:
                  type: string
                description:
                  type: string
                sampleType:
                  type: string
                turnaroundHours:
                  type: integer
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogTest'

  /catalog/tests/{testId}:
    get:
      operationId: getCatalogTest
      summary: Get catalog test
      tags: [Catalog]
      parameters:
        - name: testId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Catalog test
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogTest'
    patch:
      operationId: updateCatalogTest
      summary: Update catalog test
      tags: [Catalog]
      parameters:
        - name: testId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                sampleType:
                  type: string
                turnaroundHours:
                  type: integer
                isActive:
                  type: boolean
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogTest'
    delete:
      operationId: deleteCatalogTest
      summary: Delete (deactivate) catalog test
      tags: [Catalog]
      parameters:
        - name: testId
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Deleted

  /catalog/panels:
    get:
      operationId: listCatalogPanels
      summary: List catalog panels (tenant-scoped)
      tags: [Catalog]
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: Catalog panels
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CatalogPanel'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      operationId: createCatalogPanel
      summary: Create a catalog panel
      tags: [Catalog]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, name]
              properties:
                code:
                  type: string
                name:
                  type: string
                description:
                  type: string
                testIds:
                  type: array
                  items:
                    type: string
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogPanel'

  # ─── Catalog Parameters ───────────────────────────────────────────────────
  /catalog/parameters:
    get:
      operationId: listParameters
      summary: List parameters (tenant-scoped)
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: Parameters list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Parameter'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      operationId: createParameter
      summary: Create a parameter
      tags: [Catalog]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, name]
              properties:
                code:
                  type: string
                name:
                  type: string
                unit:
                  type: string
                dataType:
                  type: string
                  enum: [numeric, text, boolean, coded]
      responses:
        "201":
          description: Parameter created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Parameter'
        "409":
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /catalog/parameters/{parameterId}:
    get:
      operationId: getParameter
      summary: Get parameter by ID
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: parameterId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Parameter'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      operationId: updateParameter
      summary: Update parameter
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: parameterId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                unit:
                  type: string
                dataType:
                  type: string
                isActive:
                  type: boolean
      responses:
        "200":
          description: Parameter updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Parameter'

  /catalog/tests/{testId}/parameters:
    get:
      operationId: listTestParameters
      summary: List parameter mappings for a test
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: testId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Test parameter mappings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TestParameterMapping'
    post:
      operationId: addTestParameter
      summary: Add parameter mapping to test
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: testId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [parameterId]
              properties:
                parameterId:
                  type: string
                ordering:
                  type: integer
      responses:
        "201":
          description: Mapping created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestParameterMapping'

  /catalog/tests/{testId}/parameters/{parameterId}:
    delete:
      operationId: removeTestParameter
      summary: Remove parameter mapping from test
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: testId
          in: path
          required: true
          schema:
            type: string
        - name: parameterId
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Mapping removed

  /catalog/panels/{panelId}/tests:
    get:
      operationId: listPanelTests
      summary: List test mappings for a panel
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: panelId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Panel test mappings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PanelTestMapping'
    post:
      operationId: addPanelTest
      summary: Add test mapping to panel
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: panelId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [testId]
              properties:
                testId:
                  type: string
                ordering:
                  type: integer
      responses:
        "201":
          description: Mapping created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PanelTestMapping'

  /catalog/panels/{panelId}/tests/{testId}:
    delete:
      operationId: removePanelTest
      summary: Remove test mapping from panel
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: panelId
          in: path
          required: true
          schema:
            type: string
        - name: testId
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Mapping removed

  # ─── Catalog Reference Ranges ──────────────────────────────────────────────
  /catalog/reference-ranges:
    get:
      operationId: listReferenceRanges
      summary: List reference ranges (tenant-scoped)
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: parameterId
          in: query
          schema:
            type: string
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: Reference ranges
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReferenceRange'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      operationId: createReferenceRange
      summary: Create reference range
      tags: [Catalog]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReferenceRange'
      responses:
        "201":
          description: Reference range created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReferenceRange'

  /catalog/reference-ranges/{id}:
    put:
      operationId: updateReferenceRange
      summary: Update reference range
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReferenceRange'
      responses:
        "200":
          description: Reference range updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReferenceRange'
    delete:
      operationId: deleteReferenceRange
      summary: Delete reference range
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Deleted

  # ─── Catalog Import/Export Jobs ────────────────────────────────────────────
  /catalog/import-jobs:
    post:
      operationId: createImportJob
      summary: Start a catalog import job (idempotent by payloadHash)
      tags: [Catalog]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CatalogImportPayload'
      responses:
        "201":
          description: Import job created or existing returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRun'
        "403":
          description: Feature disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      operationId: listImportJobs
      summary: List import jobs
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: Import jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/JobRun'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /catalog/import-jobs/{id}:
    get:
      operationId: getImportJob
      summary: Get import job by ID
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Import job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRun'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /catalog/import-jobs/{id}:retry:
    post:
      operationId: retryImportJob
      summary: Retry a failed import job
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Job re-queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRun'
        "409":
          description: Job is not in failed state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /catalog/export-jobs:
    post:
      operationId: createExportJob
      summary: Start a catalog export job
      tags: [Catalog]
      security:
        - bearerAuth: []
      responses:
        "201":
          description: Export job created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRun'
    get:
      operationId: listExportJobs
      summary: List export jobs
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: Export jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/JobRun'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /catalog/export-jobs/{id}:
    get:
      operationId: getExportJob
      summary: Get export job by ID
      tags: [Catalog]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Export job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRun'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ─── Audit Events ─────────────────────────────────────────────────────────
  /audit-events:
    get:
      operationId: listAuditEvents
      summary: List audit events (with filters)
      tags: [Audit]
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: tenantId
          in: query
          schema:
            type: string
        - name: actorUserId
          in: query
          schema:
            type: string
        - name: entityType
          in: query
          schema:
            type: string
        - name: entityId
          in: query
          schema:
            type: string
        - name: action
          in: query
          schema:
            type: string
        - name: correlationId
          in: query
          schema:
            type: string
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: Audit events
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditEvent'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  # ─── Jobs ─────────────────────────────────────────────────────────────────
  /jobs:
    get:
      operationId: listJobs
      summary: List jobs across all queues
      tags: [Jobs]
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: queue
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [waiting, active, completed, failed, delayed]
      responses:
        "200":
          description: Jobs list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /jobs/failed:
    get:
      operationId: listFailedJobs
      summary: List failed jobs
      tags: [Jobs]
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        "200":
          description: Failed jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /jobs/failed-count:
    get:
      operationId: getFailedJobsCount
      summary: Get count of failed jobs (for dashboard)
      tags: [Jobs]
      responses:
        "200":
          description: Failed jobs count
          content:
            application/json:
              schema:
                type: object
                required: [count]
                properties:
                  count:
                    type: integer

  /jobs/{jobId}:retry:
    post:
      operationId: retryJob
      summary: Retry a failed job (audited command)
      tags: [Jobs]
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Job re-queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        "404":
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "409":
          description: Job is not in a failed state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ─── Patients ─────────────────────────────────────────────────────────────
  /patients:
    get:
      operationId: listPatients
      summary: List patients (tenant-scoped)
      tags: [Patients]
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: lastName
          in: query
          schema:
            type: string
        - name: mrn
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Patients list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Patient'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      operationId: createPatient
      summary: Create a patient record
      tags: [Patients]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [firstName, lastName, mrn]
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                dateOfBirth:
                  type: string
                  format: date
                gender:
                  type: string
                mrn:
                  type: string
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        "409":
          description: MRN already exists in tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /patients/{patientId}:
    get:
      operationId: getPatient
      summary: Get patient by ID
      tags: [Patients]
      parameters:
        - name: patientId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Patient record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      operationId: updatePatient
      summary: Update patient record
      tags: [Patients]
      parameters:
        - name: patientId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                dateOfBirth:
                  type: string
                  format: date
                gender:
                  type: string
      responses:
        "200":
          description: Updated patient
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ─── Encounters ───────────────────────────────────────────────────────────
  /encounters:
    get:
      operationId: listEncounters
      summary: List encounters (tenant-scoped)
      tags: [Encounters]
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: status
          in: query
          schema:
            type: string
        - name: patientId
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Encounters list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Encounter'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      operationId: createEncounter
      summary: Register a new encounter
      tags: [Encounters]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [patientId]
              properties:
                patientId:
                  type: string
      responses:
        "201":
          description: Encounter registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'

  /encounters/{encounterId}:
    get:
      operationId: getEncounter
      summary: Get encounter by ID
      tags: [Encounters]
      parameters:
        - name: encounterId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Encounter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /encounters/{encounterId}:order-lab:
    post:
      operationId: orderLab
      summary: Add a lab order to encounter
      tags: [Encounters]
      parameters:
        - name: encounterId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [testId]
              properties:
                testId:
                  type: string
                priority:
                  type: string
                  enum: [routine, stat, urgent]
                  default: routine
      responses:
        "200":
          description: Lab ordered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        "409":
          description: Invalid transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /encounters/{encounterId}:collect-specimen:
    post:
      operationId: collectSpecimen
      summary: Mark specimen as collected
      tags: [Encounters]
      parameters:
        - name: encounterId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [labOrderId, barcode, type]
              properties:
                labOrderId:
                  type: string
                barcode:
                  type: string
                type:
                  type: string
      responses:
        "200":
          description: Specimen collected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        "409":
          description: Invalid transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /encounters/{encounterId}:result:
    post:
      operationId: enterResult
      summary: Enter lab result
      tags: [Encounters]
      parameters:
        - name: encounterId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [labOrderId, value]
              properties:
                labOrderId:
                  type: string
                value:
                  type: string
                unit:
                  type: string
                referenceRange:
                  type: string
                flag:
                  type: string
                  enum: [normal, high, low, critical]
      responses:
        "200":
          description: Result entered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        "409":
          description: Invalid transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /encounters/{encounterId}:verify:
    post:
      operationId: verifyEncounter
      summary: Verify lab results (requires result.verify permission)
      tags: [Encounters]
      parameters:
        - name: encounterId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Encounter verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        "409":
          description: Invalid transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /encounters/{encounterId}:cancel:
    post:
      operationId: cancelEncounter
      summary: Cancel encounter
      tags: [Encounters]
      parameters:
        - name: encounterId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Encounter cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        "409":
          description: Invalid transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
